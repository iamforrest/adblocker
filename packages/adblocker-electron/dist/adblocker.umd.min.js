!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("electron"),require("tldts-experimental"),require("@cliqz/adblocker")):"function"==typeof define&&define.amd?define(["exports","electron","tldts-experimental","@cliqz/adblocker"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={},e.electron,e.tldtsExperimental,e.adblocker)}(this,(function(e,t,s,r){"use strict";function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}var o=i(t);const{ipcMain:n}=o;function l(e){const{id:t,url:s,resourceType:i,referrer:o,webContentsId:n}=e;return r.Request.fromRawDetails(n?{_originalRequestDetails:e,requestId:`${t}`,sourceUrl:o,tabId:n,type:i||"other",url:s}:{_originalRequestDetails:e,requestId:`${t}`,sourceUrl:o,type:i||"other",url:s})}process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";class c{constructor(e,t){this.session=e,this.blocker=t,this.onBeforeRequest=(e,s)=>t.onBeforeRequest(e,s),this.onGetCosmeticFiltersFirst=(e,s)=>t.onGetCosmeticFiltersFirst(e,s),this.onGetCosmeticFiltersUpdated=(e,s,r)=>t.onGetCosmeticFiltersUpdated(e,s,r),this.onHeadersReceived=(e,s)=>t.onHeadersReceived(e,s),this.onIsMutationObserverEnabled=e=>t.onIsMutationObserverEnabled(e)}enable(){this.blocker.config.loadCosmeticFilters,!0===this.blocker.config.loadNetworkFilters&&(this.session.webRequest.onHeadersReceived({urls:["<all_urls>"]},this.onHeadersReceived),this.session.webRequest.onBeforeRequest({urls:["<all_urls>"]},this.onBeforeRequest))}disable(){!0===this.blocker.config.loadNetworkFilters&&(this.session.webRequest.onHeadersReceived(null),this.session.webRequest.onBeforeRequest(null)),!0===this.blocker.config.loadCosmeticFilters&&n.removeListener("get-cosmetic-filters",this.onGetCosmeticFiltersUpdated)}}class a extends r.FiltersEngine{constructor(){super(...arguments),this.contexts=new WeakMap,this.onIsMutationObserverEnabled=e=>{e.returnValue=this.config.enableMutationObserver},this.onGetCosmeticFiltersFirst=(e,t)=>{const r=s.parse(t),i=r.hostname||"",o=r.domain||"",{active:n,styles:l,scripts:c,extended:a}=this.getCosmeticsFilters({domain:o,hostname:i,url:t,getBaseRules:!0,getInjectionRules:!0,getExtendedRules:!0,getRulesFromHostname:!0,getRulesFromDOM:!1,callerContext:{frameId:e.frameId,processId:e.processId}});!1!==n?(this.injectStyles(e.sender,l),e.sender.send("get-cosmetic-filters-response",{active:n,extended:a,styles:""}),e.returnValue=c):e.returnValue=null},this.onGetCosmeticFiltersUpdated=(e,t,r)=>{const i=s.parse(t),o=i.hostname||"",n=i.domain||"",{active:l,styles:c,extended:a}=this.getCosmeticsFilters({domain:n,hostname:o,url:t,classes:r.classes,hrefs:r.hrefs,ids:r.ids,getBaseRules:!1,getInjectionRules:!1,getExtendedRules:!1,getRulesFromHostname:!1,getRulesFromDOM:!0,callerContext:{frameId:e.frameId,processId:e.processId,lifecycle:r.lifecycle}});!1!==l&&(this.injectStyles(e.sender,c),e.sender.send("get-cosmetic-filters-response",{active:l,extended:a,styles:""}))},this.onHeadersReceived=(e,t)=>{const s="content-security-policy",r=[],i=e.responseHeaders||{};if("mainFrame"===e.resourceType||"subFrame"===e.resourceType){const o=this.getCSPDirectives(l(e));if(void 0!==o){r.push(...o.split(";").map((e=>e.trim())));for(const[e,t]of Object.entries(i))e.toLowerCase()===s&&(r.push(...t),delete i[e]);return i[s]=[r.join(";")],void t({responseHeaders:i})}}t({})},this.onBeforeRequest=(e,t)=>{const s=l(e);if(!0===this.config.guessRequestTypeFromUrl&&"other"===s.type&&s.guessTypeOfRequest(),s.isMainFrame())return void t({});const{redirect:r,match:i}=this.match(s);t(r?{redirectURL:r.dataUrl}:i?{cancel:!0}:{})}}enableBlockingInSession(e){let t=this.contexts.get(e);return void 0!==t||(t=new c(e,this),this.contexts.set(e,t),t.enable()),t}disableBlockingInSession(e){const t=this.contexts.get(e);if(void 0===t)throw new Error("Trying to disable blocking which was not enabled");this.contexts.delete(e),t.disable()}isBlockingEnabled(e){return this.contexts.has(e)}injectStyles(e,t){t.length>0&&e.insertCSS(t,{cssOrigin:"user"})}}e.BlockingContext=c,e.ElectronBlocker=a,e.fromElectronDetails=l,Object.keys(r).forEach((function(t){"default"===t||Object.prototype.hasOwnProperty.call(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})}))}));
//# sourceMappingURL=adblocker.umd.min.js.map
