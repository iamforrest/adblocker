!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@cliqz/adblocker-extended-selectors"),require("@cliqz/adblocker-content")):"function"==typeof define&&define.amd?define(["exports","@cliqz/adblocker-extended-selectors","@cliqz/adblocker-content"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={},e.adblockerExtendedSelectors,e.adblockerContent)}(this,(function(e,t,o){"use strict";let n=!0,i=null,r=null;const c=new Set,s=[],l=new Map;function d(){null!==i&&(i.stop(),i=null)}function u(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getCosmeticsFilters",...e},(e=>{void 0!==e&&t(e)}))}))}function f(e,o,n){var i;const r=null===(i=n.get(e))||void 0===i?void 0:i.get(o);if(void 0!==r)return r;const c=new Set(t.querySelectorAll(e,o.ast));if(void 0!==o.attribute){let t=n.get(e);void 0===t&&(t=new Map,n.set(e,t));let i=t.get(o);void 0===i&&(i=new Set,t.set(o,i));for(const e of c)i.add(e)}return c}function a(e){if(0!==s.length&&!c.has(window.document.documentElement)){for(const t of e){if(t===window.document.documentElement){c.clear(),c.add(t);break}c.add(t)}null===r&&(r=setTimeout((()=>{r=null,function(){if(0===c.size||0===s.length)return;const e=new Map,t=new Map,o=[...c].filter((e=>!0===e.isConnected));c.clear();for(const n of o)for(const o of s)for(const i of f(n,o,e))!0===o.remove?(i.textContent="",i.remove()):void 0!==o.attribute&&!1===l.has(i)&&t.set(i,{selector:o,root:n});for(const[e,{selector:o,root:n}]of t.entries())void 0!==o.attribute&&(e.setAttribute(o.attribute,""),l.set(e,{selector:o,root:n}));for(const[t,{selector:o,root:n}]of[...l.entries()])void 0!==o.attribute&&(!1!==n.isConnected&&!1!==t.isConnected&&!1!==f(n,o,e).has(t)||(l.delete(t),t.removeAttribute(o.attribute)))}()}),1e3))}}function m(e,{active:t,scripts:i,extended:r}){if(!1===t)return n=!1,void d();if(n=!0,i)for(const t of i)try{o.injectScript(t,e.document)}catch(e){}r&&r.length>0&&(s.push(...r),a([e.document.documentElement]))}e.injectCosmetics=function(e,t=!0,r=u){r({lifecycle:"start",ids:[],classes:[],hrefs:[]}).then((t=>m(e,t))),e.addEventListener("DOMContentLoaded",(()=>{i=new o.DOMMonitor((t=>{"elements"===t.type?0!==t.elements.length&&a(t.elements):r({...t,lifecycle:"dom-update"}).then((t=>m(e,t)))})),i.queryAll(e),n&&t&&i.start(e)}),{once:!0,passive:!0}),e.addEventListener("pagehide",d,{once:!0,passive:!0})}}));
//# sourceMappingURL=adblocker.umd.min.js.map
